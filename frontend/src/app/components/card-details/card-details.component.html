<div *ngIf="isLoading" class="loading-container">
  <h2>{{ 'CARD.LOADING' | translate }}</h2>
</div>

<div class="details-container" *ngIf="!isLoading && card">

  <button class="back-btn" (click)="voltar()">
    <mat-icon>arrow_back</mat-icon>
  </button>

  <div class="top-deck">

    <div class="card-profile">
      <div class="card-image-box">
        <img [src]="card.imageUrl" class="main-img" (error)="card.imageUrl = 'assets/placeholder_card.png'">
      </div>

      <div class="card-info-box">
        <div class="header-row">
          <h1>{{ card.name }}</h1>
          @if (isLoggedIn) {
          <button class="favorite-btn" (click)="toggleFavorite()" [class.active]="isFavorite"
            title="Adicionar aos Favoritos">
            <mat-icon>{{ isFavorite ? 'bookmark' : 'bookmark_add' }}</mat-icon>
          </button>
          }
        </div>
        <span class="set-badge">{{ card.setName }}</span>

        <div class="price-box">
          <span class="label">{{ 'CARD.CURRENT_PRICE' | translate }}</span>
          <span class="value">${{ card.priceUsd | number:'1.2-2' }}</span>
        </div>
        <a [href]="getLigaMagicLink()" target="_blank" class="ligamagic-btn">
          <mat-icon>shopping_cart</mat-icon>
          {{ 'CARD.SEE_LIGAMAGIC' | translate }}
        </a>
      </div>
    </div>

    <div class="chart-panel">
      <div class="chart-header">
        <h3>{{ 'CARD.PRICE_HISTORY' | translate }}</h3>
        <span class="last-update" *ngIf="card.lastUpdate">
          <mat-icon>update</mat-icon> {{ 'CARD.UPDATED_AT' | translate }}: {{ getLastUpdateText() }}
        </span>
      </div>
      <div class="chart-wrapper">
        <canvas baseChart [data]="lineChartData" [options]="lineChartOptions" [type]="'line'">
        </canvas>
      </div>
    </div>

  </div>

  <hr class="divider">

  <div class="prints-section">
    <h2>{{ 'CARD.OTHER_VERSIONS' | translate }}</h2>
    <div class="prints-grid">
      @for (print of prints; track print.id) {
      <div class="print-item" (click)="selecionarEdicao(print.id)" [class.active]="card.id === print.id">
        <img [src]="print.image_uris?.normal || print.card_faces?.[0]?.image_uris?.normal" [title]="print.set_name">
        <span class="print-set">{{ print.set_name }}</span>
        <span class="print-price">
          {{ (print.prices?.usd | currency:'USD') || '---' }}
        </span>
      </div>
      } @empty {
      <p class="empty-prints">Nenhuma outra edição encontrada.</p>
      }
    </div>
  </div>

</div>