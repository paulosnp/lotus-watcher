<div class="account-container">
    <div class="settings-card">
        <div class="header">
            <button class="back-btn" (click)="goBack()" title="Voltar">
                <mat-icon>arrow_back</mat-icon>
            </button>
            <div class="header-content">
                <h1>Configurações da Conta</h1>
                <p>Gerencie suas informações pessoais e segurança.</p>
            </div>
        </div>

        @if (isLoading) {
        <p class="loading">Carregando informações...</p>
        } @else {

        <!-- Mensagens de Sucesso/Erro -->
        @if (message) {
        <div class="alert success">{{ message }}</div>
        }
        @if (error) {
        <div class="alert error">{{ error }}</div>
        }

        <!-- BLOCO 1: Informações do Usuário -->
        <div class="section profile-section">
            <div class="section-header">
                <h2>Perfil</h2>
                @if (!isEditingProfile) {
                <button class="edit-btn" (click)="toggleEditProfile()">
                    <mat-icon>edit</mat-icon> Editar
                </button>
                }
            </div>

            <div class="info-group">
                <label>Email</label>
                <div class="display-value email-locked">
                    <mat-icon>lock</mat-icon> {{ user?.email }}
                </div>
            </div>

            <div class="info-group">
                <label>Nome de Exibição (Nick)</label>
                @if (isEditingProfile) {
                <div class="edit-row">
                    <input type="text" [(ngModel)]="newName" placeholder="Seu novo nick">
                    <div class="actions">
                        <button class="save-btn" (click)="saveProfile()">Salvar</button>
                        <button class="cancel-btn" (click)="toggleEditProfile()">Cancelar</button>
                    </div>
                </div>
                } @else {
                <div class="display-value">{{ user?.name }}</div>
                }
            </div>
        </div>

        <hr class="divider">

        <!-- BLOCO 2: Segurança -->
        <div class="section security-section">
            <div class="section-header">
                <h2>Segurança</h2>
            </div>

            @if (!isChangingPassword) {
            <button class="change-pass-btn" (click)="toggleChangePassword()">
                <mat-icon>vpn_key</mat-icon> Alterar Senha
            </button>
            } @else {
            <div class="password-form">
                <h3>Nova Senha</h3>
                <div class="form-group">
                    <label>Senha Atual</label>
                    <input type="password" [(ngModel)]="passwordData.oldPassword">
                </div>
                <div class="form-group">
                    <label>Nova Senha</label>
                    <input type="password" [(ngModel)]="passwordData.newPassword">
                </div>
                <div class="form-group">
                    <label>Confirmar Nova Senha</label>
                    <input type="password" [(ngModel)]="passwordData.confirmPassword">
                </div>
                <div class="actions">
                    <button class="save-btn warning" (click)="updatePassword()">Atualizar Senha</button>
                    <button class="cancel-btn" (click)="toggleChangePassword()">Cancelar</button>
                </div>
            </div>
            }
        </div>

        }
    </div>
</div>