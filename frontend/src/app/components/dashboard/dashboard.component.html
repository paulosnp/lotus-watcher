<div class="dashboard-container">

  <!-- Menu Hambúrguer (Apenas Home) -->
  <div class="home-menu-wrapper">
    <button class="menu-btn" (click)="toggleMenu()">
      <mat-icon>{{ isMenuOpen ? 'close' : 'menu' }}</mat-icon>
    </button>

    @if (isMenuOpen) {
    <div class="dropdown-menu">
      @if (!isLoggedIn) {
      <a routerLink="/login" class="menu-item"><mat-icon>login</mat-icon> Entrar</a>
      <a routerLink="/register" class="menu-item"><mat-icon>person_add</mat-icon> Criar Conta</a>
      }

      @if (isLoggedIn) {
      <a routerLink="/account" class="menu-item"><mat-icon>account_circle</mat-icon> Minha Conta</a>
      <a routerLink="/watchlist" class="menu-item"><mat-icon>favorite</mat-icon> Watchlist</a>
      <div class="menu-divider"></div>
      <button (click)="logout()" class="menu-item logout"><mat-icon>logout</mat-icon> Sair</button>
      }
    </div>
    }
  </div>

  @if (!isSearching) {
  <section class="hero-section">
    <div class="hero-content">
      <h1>Bem-vindo ao <span class="highlight">Lotus Watcher</span></h1>
      <p>Monitore preços, descubra tendências e proteja sua coleção.</p>

      <div class="hero-search-wrapper">
        <app-search [isCompact]="true"></app-search>

        <a routerLink="/sets" class="action-btn-home" title="Expansões (Sets)">
          <mat-icon>style</mat-icon>
        </a>

        <button class="action-btn-home" (click)="onRandomCard()" title="Carta Aleatória">
          <mat-icon>shuffle</mat-icon>
        </button>
      </div>

    </div>
  </section>
  }

  @if (isSearching) {
  <section class="market-overview search-results">
    <div class="market-list" style="width: 100%">
      <div class="list-header">
        <button class="back-btn" (click)="goBack()">
          <mat-icon>arrow_back</mat-icon>
        </button>
        <mat-icon>search</mat-icon>
        <h2>Resultados para "{{ searchQuery }}"</h2>
      </div>

      <div class="cards-grid">
        @for (card of searchResults; track card.id) {
        <div class="mini-card" (click)="irParaDetalhes(card.id)">
          <div class="card-thumb">
            <img [src]="card.imageUrl" alt="{{ card.name }}"
              (error)="card.imageUrl = 'https://i.imgur.com/LdOBU1I.jpg'">
          </div>
          <div class="card-info">
            <span class="name">{{ card.name }}</span>
            <span class="set">{{ card.setName }}</span>
          </div>
          <div class="price-block">
            <span class="current-price">${{ card.priceUsd }}</span>
          </div>
        </div>
        } @empty {
        @if(isLoading) {
        <p class="empty-msg">Buscando...</p>
        } @else {
        <p class="empty-msg">Nenhuma carta encontrada.</p>
        }
        }
      </div>
    </div>
  </section>
  } @else {
  <section class="market-overview">

    <div class="market-list winners">
      <div class="list-header">
        <mat-icon>trending_up</mat-icon>
        <h2>Maiores Altas (24h)</h2>
      </div>

      <div class="cards-grid">
        @for (card of topRisers; track card.id) {
        <div class="mini-card" (click)="irParaDetalhes(card.id)">
          <div class="card-thumb">
            <img [src]="card.imageUrl" alt="{{ card.name }}"
              (error)="card.imageUrl = 'https://i.imgur.com/LdOBU1I.jpg'">
          </div>
          <div class="card-info">
            <span class="name">{{ card.name }}</span>
            <span class="set">{{ card.setName }}</span>
          </div>
          <div class="price-block">
            <span class="price up">+{{ card.priceChangePercentage | number:'1.1-2' }}%</span>
            <span class="current-price">${{ card.priceUsd }}</span>
          </div>
        </div>
        } @empty {
        <p class="empty-msg">Carregando dados do mercado...</p>
        }
      </div>
    </div>

    <div class="market-list losers">
      <div class="list-header">
        <mat-icon>trending_down</mat-icon>
        <h2>Maiores Quedas (24h)</h2>
      </div>

      <div class="cards-grid">
        @for (card of topFallers; track card.id) {
        <div class="mini-card" (click)="irParaDetalhes(card.id)">
          <div class="card-thumb">
            <img [src]="card.imageUrl" alt="{{ card.name }}"
              (error)="card.imageUrl = 'https://i.imgur.com/LdOBU1I.jpg'">
          </div>
          <div class="card-info">
            <span class="name">{{ card.name }}</span>
            <span class="set">{{ card.setName }}</span>
          </div>
          <div class="price-block">
            <span class="price down">{{ card.priceChangePercentage | number:'1.1-2' }}%</span>
            <span class="current-price">${{ card.priceUsd }}</span>
          </div>
        </div>
        } @empty {
        <p class="empty-msg">Carregando dados do mercado...</p>
        }
      </div>
    </div>

  </section>
  }

</div>